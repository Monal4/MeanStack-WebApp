<% include ../partials/header %>

<!-- 
Show Survey Information.
This is the page that displays the survey information in tabular format for easy and simple view functionality.
-->

<div class="container-fluid border border-bottom-1 border-top-0 border-right-0 border-left-0" style="padding: 0px; background-color: #f6f5f3">
                    <h1 align="center"><span style="color:#3d3d3f">Dashboard</span></h1>
                <!--  <h3 align="center">List of our surveys</h3> -->
                        <h2>
                            <ul>
                    <% if (currentUser) {  %>  
                        <li style="color:#3d3d3f;text-align:center" class="text-black">Welcome <%= currentUser.firstName %></li>
                    <% } %>
                        <ul>           
                </h2>
                </div>

<div class="container" >

    <!--  <header class="jumbotron">   -->
    <!-- <div class="container"> -->
            
            <!--This was a jumbotron that has just search button for surveys-->
    <!--   <p>
            <form class="form-inline" action="/surveys" method="GET">
                <div class="form-group">
                    <input type="text" class="form-control" name="search" placeholder="Search Surveys">
                    <input type="submit" class="form-control btn btn-default" value="Search">
                </div>
            </form>
        </p> -->
    <!--    </div> -->
<!-- </header> -->
<!-- <form class="form-inline float-left" action="/surveys" method="GET">
                <div class="row">

                <div class="col">
                    <input type="text" action="/surveys" class="form-control" name="search" placeholder="Search Surveys">
                </div>

                <div class="col">
                    <input type="submit" class="form-control btn btn-default" value="Search">
                </div>
        </div>
                </form>-->
<br></br>

    <div class="row d-block d-sm-none">
    <div class="col-lg-3 col-md-3 col-sm-3 col-xs-12">
        <form class="form-inline  float-left" action="/surveys" method="GET">
        <input type="text" style="margin-bottom: 0px" class="float-left" name="search" placeholder="Search Surveys">
            <input type="submit" style="background-color: #7dce94; color:white; padding:0px" class="form-control btn" value="Search">
    </form>
        </div>
    <div class="col-lg-6 col-md-6 col-sm-5 col-xs-12 offset-lg-2 offset-md-2">
        <form class="form-inline float-left">
        <a class="float-right btn" style="background-color: #7dce94" href="/surveys/new">Create New Survey </a> 
    </form>
    </div>
    </div>

    <div class="conatiner d-none d-sm-block dashboardBtn" style="padding:20px 20px 0px 20px">  
                
        <div class="col-lg-4 col-md-4">  
                <form class="form-inline float-left" action="/surveys" method="GET"> 
                        <div class="form-group mx-sm-2 mb-2">
                            <input type="text" class="form-control" name="search" placeholder="Search Surveys">
                        </div>
                        <button type="submit" class="btn mb-2 rounded-0" style="background-color:#7dce94">Search</button>
                        </form>
                    </div>
        <div class="col-lg-6 col-md-8 float-right">
    <!--     <a class=" btn rounded-0 float-right mx-2" href="/surveys/new">Create New Survey</a> -->
            <button class="btn rounded-0 float-right mx-2" id="mybtn" style="background-color:#7dce94">Create New Survey</button>
            
        </div>  
        

        <div id="mymodal" class="modal"> 
            
                    <div class="modal-content" style="padding: 0px;">
                    
                        <nav class="navbar navbar-light" style="background-color:#7dce94; margin-bottom: 0px;align-content: center;">
                            <h1 style="padding-left: 13.6px;align-content: center;color: black;"> Survey Name</h1>
                                <button class="close" aria-label="Close" style="align-content: float-right; margin-right: 13.6px;">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </nav>
                    
                    <form action="/surveys" method="POST">
                        <div class="form-group" style="padding:20px;margin: 0px;">
                            <input style="padding: 0px" type="name" class="form-control" name="name" placeholder="Survey Title" id="Title">
                        </div>
                    <div class="form-inline float-left">
                        <div class="form-group " style="margin: 0px;padding: 5px;">
                            <label class="font-weight-bold"  for="startdate">Start Date</label> 
                            <input  placeholder="Start Date" value="Start Date" name="startdate" type="date">

                            <label class="font-weight-bold" for="enddate">End Date</label>
                            <input  id="date" name="enddate" type="date">
                        </div>
                    </div>
                    <div class="form-inline float-right">
                        <div class="form-group" style="margin: 0px;padding: 5px;">
                            
                                <input type="checkbox" id="featuredSurveys" name="featuredSurveys" value="featuredSurveys">
                                <label for="featuredSurveys">Add to Featured Surveys</label>
                               <input type="checkbox" id="publicSurvey" name="publicSurvey" value="publicSurvey">
                                <label for="publicSurvey">Make the Survey Public</label>
                              
                                <input type="checkbox" id="hideRespondentsNav" name="hideRespondentsNav" value="hideRespondentsNav">
                                <label for="hideRespondentsNav">Hide Respondents UI Elements</label>
                              
                    </div>
                </form>
                
                        </div>
        <script>
                var btn = document.getElementById("mybtn");
                var modal = document.getElementById("mymodal");
                var closebtn = document.getElementsByClassName("close")[0];

                var formtitle = document.getElementById("Title");

                if(formtitle==null){
                    alert("Please enter valid Title");
                }

                btn.onclick = () => {
                    modal.style.display = "block";
                }

                closebtn.onclick = () => {
                    modal.style.display = "none";
                }

            </script>

                </div>
        </div>
    

<!-- This part is a chart implementation-->
<!--
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js" type="text/javascript"></script>

<div class="container">
    <canvas id="myChart" width="400" height="160"></canvas>
</div>

<script>
var ctx = document.getElementById("myChart").getContext('2d');

//Array of survey data
var suvreyData = [];
    <% surveys.forEach(function(survey) { %>
        suvreyData.push(<%=survey.questions.length%>)
    <% }) %>

var surveyLabels = [];
<% surveys.forEach(function(survey) { %>
        surveyLabels.push("<%=survey.name%>");
<% }) %>

//chart variable to display
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: surveyLabels,
        datasets: [{
            label: 'Questions',
            data: suvreyData,
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
            ],
            borderColor: [
                'rgba(255,99,132,1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    }
});
</script>
-->
<div class="container d-none d-md-block" >
        <table class="table" style="border: 1px; font-size: 17px; background-color:#f6f5f3" id="SurveyList">
    <tr>
    
    <!--  <th>Created At</th>
    <th>Survey End Date</th>-->
    
    
    </tr>
    <% surveys.forEach(function(survey) { %>
    <tr>
        <td style="text-align:left"><%= survey.name %><br></br><span style="font-size:13px"><%=moment(survey.createdAt).format('MMMM Do YYYY')%>
        |<%= moment(survey.enddate).format('MMMM Do YYYY') %></span></td>
        
        <td><%= survey.author.firstName %></td>
        <td><%= survey.questions.length %></td>
        <td><%= survey.survey_answer.length %></td>
        
        <td style="text-align:center">
            <% if(currentUser && survey.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
            <div class="btn-group dropright">
                <button type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span>&#8942;</span> 
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" href="/surveys/<%= survey._id %>/edit">Edit Survey</a>
                <a class="dropdown-item" href="/surveys/<%= survey._id %>">View Survey</a>
                    <a class="dropdown-item" href="/surveys">View Report</a>
                    
                    <form action="/surveys/<%= survey._id %>?_method=DELETE" method="post">
                    <button style="height:42px; padding:10px" class="dropdown-item" >Delete Survey</button>
                </form>
                    
                
                </div>
            </div>
            <% } %>
        </td>

    <!--    <td>

            <div class="btn-toolbar" role="toolbar">
                <% if(currentUser && survey.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
            <div class="btn-group mr-2" role="group">
                <a href="/surveys/<%= survey._id %>" class="btn btn-outline-secondary">View Survey</a>
            </div>
            <div class="btn-group mr-2" role="group">
                <form id="delete-inline" action="/surveys/<%= survey._id %>?_method=DELETE" method="post">
                <button class="btn btn-outline-danger float-right">Delete</button>
                </form>
            </div>
            <% } %>
            </div>
        </td> -->
    </tr>
    <% }) %>
</table>
</div>

<div class="container d-sm-block d-md-none" style="display:flex; flex-wrap: wrap;">
    
        
                <% surveys.forEach(function(survey) { %> 
    <table class="table table" style="border: 1px; font-size: 17px; background-color:#f6f5f3" id="SurveyList">
            <tr>
            <th style="text-align: center">  <%= survey.name %> <br></br><span style="font-weight: normal">
                <%= moment(survey.createdAt).format('MMMM Do YYYY')
                %>|<%=moment(survey.enddate).format('MMMM Do YYYY')%></th>
    
            </tr>
            <tr style="text-align: left">
                <th>Author Name</th>
                <td style="text-align: right"><%= survey.author.firstName %></td>
            </tr>
            <tr style="text-align: left">
                <th>No Of Questions</th>
                <td style="text-align: right"><%= survey.questions.length %></td>
            </tr>
            <tr style="text-align: left">
                <th>No Of Respondents</th>
                <td style="text-align: right"><%= survey.survey_answer.length %></td>  
            </tr>
            <% if(currentUser && survey.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
            <tr style="text-align: left">
                <th>View This Survey</th>
                <td style="text-align: right"><a class="dropdown-item" href="/surveys/<%= survey._id %>">View Survey</a></td>  
            </tr>
            <tr style="text-align: left">
                <th>Delete This Survey</th>
                <td style="text-align: right"><form id="delete-inline" action="/surveys/<%= survey._id %>?_method=DELETE" method="post">
                    <button class="dropdown-item" >Delete Survey</button>
                </form></td>  
            </tr>
            
            <% } %>
        </table>
            <% }) %>
            
    
</div>

<!-- <div class="container row text-left" style="display:flex; flex-wrap: wrap;">
        <table id="SurveyList">
    <tr>
    <th>Name</th>
    <th>Created At</th>
    <th>Survey End Date</th>
    <th>Author</th>
    
    <th></th>
    </tr>
    <% surveys.forEach(function(survey) { %>
    <tr>
        <td><%= survey.name %></td>
        <td><%= moment(survey.createdAt).format('MMMM Do YYYY')%></td>
        <td><%= survey.enddate %></td>
        <td><%= survey.author.firstName %></td>
        
        <td>
            <div class="btn-toolbar" role="toolbar">
                <% if(currentUser && survey.author.id.equals(currentUser._id) || currentUser && currentUser.isAdmin) { %>
            <div class="btn-group mr-2" role="group">
                <a href="/surveys/<%= survey._id %>" class="btn btn-outline-secondary">View Survey</a>
            </div>
            <div class="btn-group mr-2" role="group">
                <form id="delete-inline" action="/surveys/<%= survey._id %>?_method=DELETE" method="post">
                <button class="btn btn-outline-danger float-right">Delete</button>
                </form>
            </div>
            <% } %>
            </div>
        </td>
    </tr>
    <% }) %>
</table>
</div>
-->
</div>

<% include ../partials/footer %>